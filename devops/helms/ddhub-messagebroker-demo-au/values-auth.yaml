
# Default values for did-auth-proxy-helm.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.
did-auth-proxy-helm:
  enabled: true
  replicaCount: 1

  image:
    repository: aemoprivatecontainerregistry.azurecr.io/did-auth-proxy
    pullPolicy: IfNotPresent
    # Overrides the image tag whose default is the chart appVersion.
    tag: "9480e18c-ebb4-4f55-b762-fc01962e982e" # 31 Aug 2022 latest

  imagePullSecrets: 
    - name: regcred
  nameOverride: "did-auth-proxy-demo"
  fullnameOverride: "did-auth-proxy-demo"

  serviceAccount:
    # Specifies whether a service account should be created
    create: true
    # Annotations to add to the service account
    annotations: {}
    # The name of the service account to use.
    # If not set and create is true, a name is generated using the fullname template
    name: ""

  podAnnotations: {}

  podSecurityContext: {}
    # fsGroup: 2000

  securityContext: {}
    # capabilities:
    #   drop:
    #   - ALL
    # readOnlyRootFilesystem: true
    # runAsNonRoot: true
    # runAsUser: 1000

  service:
    type: ClusterIP
    port: 80

  ingress:
    enabled: false

  config:
    enabled: false
    secretRefName: {}
    configRefName: {}

  #for now dummy configs
  appValues:
    PORT: 80
    ACCEPTED_ROLES: user.roles.ddhub.apps.energyweb.iam.ewc,topiccreator.roles.ddhub.apps.energyweb.iam.ewc
    JWT_ACCESS_TTL: 3600
    JWT_REFRESH_TTL: 86400
    ENS_RESOLVER_ADDRESS: 0xcf72f16Ab886776232bea2fcf3689761a0b74EfE

  opsValues:
    RPC_URL: https://volta-rpc-vkn5r5zx4ke71f9hcu0c.energyweb.org/
    CACHE_SERVER_URL: https://identitycache-staging.energyweb.org/v1
    REDIS_HOST: ddhub-messagebroker-demo-redis-master.ddhub-demo.svc
    REDIS_PORT: 6379

  resources: {}
    # We usually recommend not to specify default resources and to leave this as a conscious
    # choice for the user. This also increases chances charts run on environments with little
    # resources, such as Minikube. If you do want to specify resources, uncomment the following
    # lines, adjust them as necessary, and remove the curly braces after 'resources:'.
    # limits:
    #   cpu: 100m
    #   memory: 128Mi
    # requests:
    #   cpu: 100m
    #   memory: 128Mi

  autoscaling:
    enabled: false
    minReplicas: 1
    maxReplicas: 100
    targetCPUUtilizationPercentage: 80
    # targetMemoryUtilizationPercentage: 80

  nodeSelector: {}

  tolerations: []

  affinity: {}

  sealedSecret:
    enabled: true
    annotations: {}
    encryptedData: 
      CACHE_SERVER_LOGIN_PRVKEY: AgAFWQGEra6V/J5lsCbjzyoQ5Bg0YIywf54qoANMm31XaztxBoG50NiZkkGYpPm/eTX1CwRI++B9Bn7LNuRNnMs0tJBbchIDoNYPtUg5pcPKmc6feVTkmlq9YWEu1PU5AIp/BzbMdwwn/FUx+imnWNKeVVxMAjwHbxX5ZiQKe0FIW/2Dg+60TCYnrs+RiB4pl7Cav3Vksm6D1I6uke6fQ4SVZEQ0iHIbXy8NB594l++Fgsedq1D8AWRMSq3uP5EE+j7WdNbclKt1VZMA4tvlq53U9MN60WxCLGVQqBX7fRmlT1tSifXxKmX7/2i4wYbEu5GCVmXthw5W/I4R38FEMurq3pdt7nCtvbb/uia9Go0rfrh9XM5hASMkfIPWFlahqmo8EqjLKjOfb/iCgyJrsJF5VP/gHmbxO5a/DfgNCBoIYqPVKV6KnZj6OyrLONCY9+G9xKi9SEf1Gz7vvaQqjxmjmCRThAmLaD8apyn/7lSmxO+lzOT3WYigBjoeyjY+m8EpMbCdbgIIodJyjfMe6sQnERnbGTpIfuoZdWIXCaY7ipkns6mppIepbEEsQVEIlmHR+fyHxDk4WPx7dI2/SJlKLVW256Xaf/8A8GlrH2cyvRubwAag8nkcEZPFmHo4XvmDo2HEIv39iKT9WK2o5DA6Wyu4SxloPPOTBkk99b2uNJkbMnlrLQdsVZPFx3/5HmFjTGzZ260WkTV/DvQw6TsCWCQuOcsOjhHlbxsU+AzPVOSk2HcvD+Bqx1KlquBsAyF6I73qWkLHZ67004SKCd6/
      JWT_SECRET: AgBW8l70nwr5oAKUgE6qE6xIfnPDpl1cq2FbUvN/3Hw8Npc7MCDgE6DAplCws9G/1N9JOkiypmEs1QBfrSYiU/Mw8BWJxZvzonGX/ui4XBJa6ndemcjF3G4PwSFEXA4yQM55hDSRUjj6zIx+Cdg9LPXIT6HXL5m7k3XrRViknPjQMjqod059uzHbY4sFUMy5uhc2GwJXF2uae04pxaoCl0sf1O8YNhukyms6xTp1rLXmEIErlA5hvOkAw/VRpyDIfiEKzLAT7jPJbLjIyoeSEE5is1JdHKMCQ/SRMeD7aNnJKgjSZ3Wc4/rmAFxyYpoox18gzCx0WE5BSQPpDbtwlk9aMwuMSVjBo8VBdZdWRJOfhtiyA5GRu3RhscBlwgvxLyGUfhbZTeUq4wlAyNrwaLOkr8DjggayOTMhcHyayw8IDs3Ey1eQ0zrUlXUbr8E2lZxi/4r222CT4qdHWiBAebQWKPy/ezbNTtFKGCV12Luu3HCt39ytL2l7uRFbx1Ob0bgqA8x7aKaB3wP2XqOLsJNOm7OCzXvdgpCD2FTQyq/0aA0HhKwU2DLSGzGqhECJrlitkUzpIa/8TW3wASmBp7UmIxSDAIpQ+GO5ccj/uVbaNrrvnQ0AltgxpCIYtIhGLhUWmj5Ufz0ArfQFzP3fJ47Yxr8tNvAbLjLCT74P8X1iBN8K0CUf8SdtL6ADhBwoZaboQlI3xHXolZKwQR3tch68ce0P
      REDIS_PASSWORD: AgAU6MPip8aH8tPU0uYV9uUjNaTZMe0/AX+8TaIAucYw6NMx4Ph3TM1P5Nyj8S6Oop8nE7UaZekjLBsN087FbeyJK1nqhK5NJewOoRGQaQDXFzWV9B7hWc6K8i1lHCGKYjfnDJoGq3C+l395XWJk8yNIihx9NeCf5Ihjg5JkPR8mnGKMNrYstyoSQhxcrLtBkh6KRpXzsn4bBvG4QrbSWvB1AloQpITGur5WA4/Xmpb5FXBfS9ANIWI5LWkzCrJHmic9SgtFIaTGxqe+BkB+2dn7x/u1HNhIv47hSc27FmYZ/n8tEHFCQZ9QMB+8NRk5gXqo3fcd90H6M5O8gEh4GptHydb+gaLVJBK1M5j/XM7XH/vhWnbSxh2vw9Qp9/AuBQu/2SzbmwvNThJ+xozhx4xOEXk4crAqW28314X9LU0ZuFYtzFyTdjdx53Faq9UTA9kgLXuQKF90YfzKytvPy/CqPJa6sxWOWl6L0XnoXWiNoUnXV00ZRyffh8adNIgwREG+hXiJfICHLIpNvEn6iQDPavZC6ZE8d0gpod95Cbn5PN2NTJwEnDtHI6F+0pUVt07zkpSzu+DXrI6CwKoiluRxbX+eZTOWcXvRFz9o2j34hxrYWT/gXMGSI7cosX33y9VWInZ4oBoEYBkUGqnHJNKxUKiQY8wU130ED6HGz2JbNMDgolNzEWCVa/qx89dj7212Rphjt2NiEF9qzeaegTTu4w==
      DID_REGISTRY_ADDRESS: AgBnQ8Cxo6E5cHX/GPcOZWVWmPMgyUGucwdENEgo2klUXQRFS0gmLiIr8fKXd+669aPW1QOIVZ4lVh7ojG4qkEKDbSOoKcl2FDWkBJVhWJjgBv8LvMeHeValp+nGWRu52KtzgpjmdwgG9ITT3Nwj2sBjuEva6LDRLSzexwI9Zm1TrSN49WWro1Zos2Rloa3iD7ZAWLp4ty3G2ElgdCccb8fDdtefYb7jQIjtMfwOSBF3hnWOKY6KB/H4C1SDZdHa3Hvoz2fCs+vcxPDBYReiKiWFb9+vXT4aozCzXd/ZxFX+mXrAJtOPMBeOdTV4cZhMpi/M9v71GkKwvC1EwhxZfLByhG7TJftO48CSfblbG2dpr8eWxWHy09UhU7ZM/mDhOzDQlOd9JAAoZJ1kRf7DKpT7wx8JYhIu1ElsoLGl6rjMOxHwqLF7VgxUc6eQXRDNLxtsWcOg6ZXqUjNZvZZ5V3Y/a9VGUEAeO9cD1QerJ71c+mejl9TyTDNy3/CezbdwXGc5I4dsflUWeCBAw3pi+YgBL+afiXJ3caKS0KXAdMDGo958+JVtPReI3ec/4LLNAw+wc+vgxyHGQp21NC3mBwAf63oScRibFeAWwsI0kCXIR1AC9eRWFoJWxByTI+Ig3WEmSwrnoLB3W1SfO7t1joDkNZR/4hDrvcXqLKuDCuSknhmkMXhSX4Cd9me6wplS8XTjYxRZ29xm4LHsNlYY+6FYg0KNKY3HG8dxQS6yWx/59Bp4Me030dGKUTg=
      ENS_REGISTRY_ADDRESS: AgB4DNz3t0DTYyO3sOuqyc1wxO+C0EIneHeFXHrZeEUmBCRIwu40q5HXAqmZ+5Ot1Icp5fsW44cHGULsX7TU8t/aa70TyB53V6kDhggSMtlp+lx7rFSFbAtTUpmHUdyD3Euz39yMrtzC6zZQgJd9HbDgOwKvyI9cdmPUzTUfPX81ajpr3Uyz7MJ/zvM0xR5gKMNFxGZEvAvYc07v9sllQW2eirXVzx+AXf2btZCnneYDdZCfEEzUAlZr63bMIVlw89V0Fp8snr0RjZN9JDLuD25NLurx04tIfeqIGD37aeJtHzkjOBXEaNeAKYtJsegKAYYYtHztX7jnhjxMUakRaCz1Xy4Qd62K0WVO0GdU9k9b+XVZr+kUEDcm0sm9JZU5R2cAPLRrvzYo3GYtzBSlszTLRWpc0rIHNCi08QwarcGkX9T7MKOcIFhjSlfDFmdvfF7Ua0yfws7uUpC2I/Davv/8xlrrshLccagjZnIGvm4i8vVUwizevWoXmF47qyH2MeKdwPjbfWEmOJyiJhS38PdvESRvou1gg1lBsyLB7QrxfNki8MXjAG4EsobbZyUVNrFrRuihyZcBBkr6+t46hy8OpXJoAF4cxf3T1B5a+2f0Nd1P19eqHYXgD8UQZXBP1eBpZSu89tPvzEaSwCUy31+GE1SkCcyN/WGfvIzOJnJMAZhjDhVDqjKQDDZFmbq0TqaWErsu1OBzLFwGfGNcFxfa/45c705wjZQyYJcIsFb/tyKVQJTru58dzdA=

  ########
  # Redis

  redis:
    architecture: standalone
    auth:
      existingSecret: did-auth-proxy-demo-sealedsecret
      existingSecretPasswordKey: REDIS_PASSWORD

  ########
  # nginx
  nginx:
    fullnameOverride: "ddhub-messagebroker-proxy-demo"

    serverBlock: |-
      server {
        listen 0.0.0.0:8080;
        server_name  _;
        location ~ ^/(swagger-ui|q/openapi|health) {
            proxy_pass http://ddhub-messagebroker-demo.ddhub-demo.svc.cluster.local;
        }
        location ~ ^/auth {
            proxy_pass http://did-auth-proxy-demo.ddhub-demo.svc.cluster.local;
        }
        location ~ / {
            auth_request /token_introspection;
            proxy_pass http://ddhub-messagebroker-demo.ddhub-demo.svc.cluster.local;
        }
        location = /token_introspection {
              internal;
              proxy_method      GET;
              proxy_set_header  Authorization "$http_authorization";
              proxy_set_header  Content-Length "";
              proxy_pass        http://did-auth-proxy-demo.ddhub-demo.svc.cluster.local/auth/token-introspection;
        }
      }

    ingress:
      enabled: true
      annotations: 
        kubernetes.io/ingress.class: azure/application-gateway
        appgw.ingress.kubernetes.io/ssl-redirect: "true"
      hostname: ddhub-demo-au.energyweb.org
      pathType: Prefix
      path: /
      tls: false
      extraTls:
        - hosts:
          - ddhub-demo-au.energyweb.org
          secretName: dsb-tls-secret